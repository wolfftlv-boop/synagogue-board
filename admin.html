<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×ª×¦×•×’×” ×“×™×’×™×˜×œ×™×ª - ×™×©×™×‘×ª ×—×–×•×Ÿ ××œ×™×”×•</title>
    <!-- Tailwind CSS & Google Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700;800&family=Frank+Ruhl+Libre:wght@700;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Assistant', sans-serif; background-color: #f8fafc; overflow: hidden; }
        .font-holy { font-family: 'Frank Ruhl Libre', serif; }
        
        /* ×× ×™××¦×™×•×ª ×©×§×•×¤×™×•×ª */
        .slide { display: none; height: 100%; width: 100%; }
        .slide.active { display: flex; flex-direction: column; animation: fadeIn 0.8s ease-in-out; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ×× ×™××¦×™×™×ª ×˜×§×¡×˜ ×¨×¥ */
        .ticker-wrap { width: 100%; overflow: hidden; }
        .ticker-move {
            display: inline-block;
            white-space: nowrap;
            padding-right: 100%;
            animation: ticker 40s linear infinite;
        }
        @keyframes ticker {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* ×¢×™×¦×•×‘ ×›×¨×˜×™×¡×™× */
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col">

    <!-- 1. HEADER (18% ×’×•×‘×”) -->
    <header class="h-[18vh] bg-white border-b-[10px] border-amber-500 flex justify-between items-center px-12 shadow-2xl z-20">
        <!-- ×œ×•×’×• ×•×©× ××•×¡×“ -->
        <div class="flex items-center gap-6">
            <img id="logo-img" src="logo.png" onerror="this.style.display='none'" class="h-28 w-auto">
            <div>
                <h1 id="shul-name" class="text-7xl font-black text-slate-800 tracking-tight">×™×©×™×‘×ª ×—×–×•×Ÿ ××œ×™×”×•</h1>
                <p class="text-3xl text-slate-500 font-bold flex items-center gap-2">
                    ğŸ“ ×ª×œ ××‘×™×‘ - ×™×¤×•
                </p>
            </div>
        </div>

        <!-- ×ª××¨×™×š ×¢×‘×¨×™ ×•×¤×¨×©×” -->
        <div class="bg-amber-50 border-2 border-amber-200 rounded-[2.5rem] p-6 text-center min-w-[500px] shadow-inner">
            <div id="heb-date" class="text-5xl font-black text-amber-900 mb-2">×˜×•×¢×Ÿ ×ª××¨×™×š...</div>
            <div id="parasha" class="text-4xl font-bold text-amber-700">×¤×¨×©×ª ×”×©×‘×•×¢</div>
        </div>

        <!-- ×©×¢×•×Ÿ ×¢× ×§ -->
        <div id="clock" class="text-[9rem] font-black tabular-nums text-slate-900 tracking-tighter">00:00</div>
    </header>

    <!-- 2. MAIN AREA (74% ×’×•×‘×”) -->
    <main class="h-[74vh] relative p-12 overflow-hidden">
        <div id="slides-container" class="h-full w-full">
            
            <!-- ×©×§×•×¤×™×ª 1: ×–×× ×™ ×”×™×•× -->
            <div class="slide active" id="s0">
                <h2 class="text-8xl font-black text-center mb-16 text-slate-800 border-b-4 border-slate-200 pb-6">×–×× ×™ ×”×™×•× ğŸ™ï¸</h2>
                <div id="zmanim-list" class="grid grid-cols-1 gap-6 max-w-5xl mx-auto w-full">
                    <!-- ×–×× ×™× ×™×•×–×¨×§×• ×›××Ÿ -->
                </div>
            </div>

            <!-- ×©×§×•×¤×™×ª 2: ×ª×¤×™×œ×•×ª -->
            <div class="slide" id="s1">
                <h2 class="text-8xl font-black text-center mb-16 text-slate-800">×–×× ×™ ×ª×¤×™×œ×•×ª ğŸ•</h2>
                <div id="prayers-list" class="space-y-6 max-w-5xl mx-auto w-full">
                    <!-- ×ª×¤×™×œ×•×ª ×™×•×–×¨×§×• ×›××Ÿ -->
                </div>
            </div>

            <!-- ×©×§×•×¤×™×ª 3: ×©×™×¢×•×¨×™ ×—×ª"×ª ×•×¨××‘"× -->
            <div class="slide" id="s2">
                <h2 class="text-8xl font-black text-center mb-16 text-slate-800">×©×™×¢×•×¨×™ ×”×™×•× ğŸ“œ</h2>
                <div id="study-list" class="space-y-8 max-w-6xl mx-auto w-full">
                    <!-- ×©×™×¢×•×¨×™× ×™×•×–×¨×§×• ×›××Ÿ -->
                </div>
            </div>

            <!-- ×©×§×•×¤×™×ª 4: ×œ×•×— ××•×“×¢×•×ª -->
            <div class="slide" id="s3">
                <h2 class="text-8xl font-black text-center mb-16 text-red-600 animate-pulse">×œ×•×— ××•×“×¢×•×ª ğŸ“¢</h2>
                <div id="messages-list" class="flex flex-col justify-center items-center h-full text-center space-y-12">
                    <!-- ×”×•×“×¢×•×ª ×™×•×–×¨×§×• ×›××Ÿ -->
                </div>
            </div>

            <!-- ×©×§×•×¤×™×ª 5: ×”×§×“×©×•×ª -->
            <div class="slide" id="s4">
                <h2 class="text-8xl font-black text-center mb-16 text-slate-800">×”×œ×™××•×“ ××•×§×“×© ×œ... ğŸ•¯ï¸</h2>
                <div id="dedications-list" class="space-y-8 max-w-5xl mx-auto w-full">
                    <!-- ×”×§×“×©×•×ª ×™×•×–×¨×§×• ×›××Ÿ -->
                </div>
            </div>

        </div>
    </main>

    <!-- 3. FOOTER (8% ×’×•×‘×”) -->
    <footer class="h-[8vh] bg-amber-600 flex items-center shadow-[0_-10px_20px_rgba(0,0,0,0.1)]">
        <div class="ticker-wrap">
            <div id="ticker-text" class="ticker-move text-white text-5xl font-black font-holy">
                ×‘×¨×•×›×™× ×”×‘××™× ×œ×™×©×™×‘×ª ×—×–×•×Ÿ ××œ×™×”×• - ×ª×œ ××‘×™×‘ ×™×¤×• â€¢ × × ×œ×©××•×¨ ×¢×œ ×§×“×•×©×ª ×”××§×•× ×•×”×©×§×˜ â€¢ 
            </div>
        </div>
    </footer>

    <!-- Firebase SDKs (Compat Version) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        // ×—×™×‘×•×¨ ×œ-Firebase ×©×œ×š
        const firebaseConfig = {
            apiKey: "AIzaSyDe31VHniTkz_grYpA2e_RXx4g5Cnxa1ng",
            authDomain: "synagogue-board-tlv.firebaseapp.com",
            projectId: "synagogue-board-tlv",
            storageBucket: "synagogue-board-tlv.firebasestorage.app",
            messagingSenderId: "794671855844",
            appId: "1:794671855844:web:3e44c92b15f833784c14f1"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // -----------------------------------------
        // 1. ×©×¢×•×Ÿ ×•×–××Ÿ
        // -----------------------------------------
        setInterval(() => {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('he-IL', {hour: '2-digit', minute: '2-digit', hour12: false});
        }, 1000);

        // -----------------------------------------
        // 2. ××©×™×›×ª ×”×’×“×¨×•×ª ×•× ×ª×•× ×™× ×-Firebase
        // -----------------------------------------
        
        // ×”×’×“×¨×•×ª ×’×œ×•×‘×œ×™×•×ª (×©× ×•×˜×§×¡×˜ ×¨×¥)
        db.collection("settings").doc("global").onSnapshot(doc => {
            if (doc.exists) {
                const data = doc.data();
                if(data.shul_name) document.getElementById('shul-name').innerText = data.shul_name;
                if(data.ticker) document.getElementById('ticker-text').innerText = data.ticker + " â€¢ " + data.ticker;
            }
        });

        // ×ª×¤×™×œ×•×ª
        db.collection("prayers").onSnapshot(snap => {
            let html = '';
            snap.forEach(doc => {
                const p = doc.data();
                html += `
                    <div class="flex justify-between items-center bg-white p-8 rounded-[2rem] shadow-lg border-r-[20px] border-amber-500">
                        <span class="text-6xl font-bold">${p.name}</span>
                        <span class="text-7xl font-black text-amber-600 tabular-nums">${p.time}</span>
                    </div>`;
            });
            document.getElementById('prayers-list').innerHTML = html;
        });

        // ×”×•×“×¢×•×ª
        db.collection("messages").onSnapshot(snap => {
            let html = '';
            snap.forEach(doc => {
                const m = doc.data();
                html += `<div class="text-7xl font-black text-slate-800 leading-tight">â— ${m.text}</div>`;
            });
            document.getElementById('messages-list').innerHTML = html;
        });

        // ×”×§×“×©×•×ª
        db.collection("dedications").onSnapshot(snap => {
            let html = '';
            snap.forEach(doc => {
                const d = doc.data();
                html += `<div class="bg-amber-50 p-10 rounded-[3rem] border-2 border-amber-200 text-6xl font-black text-center shadow-xl text-amber-900">${d.text}</div>`;
            });
            document.getElementById('dedications-list').innerHTML = html;
        });

        // -----------------------------------------
        // 3. ××©×™×›×ª ×–×× ×™× ×•×¤×¨×©×” (APIs ×—×™×¦×•× ×™×™×)
        // -----------------------------------------
        async function fetchExternalData() {
            try {
                // ×ª××¨×™×š ×•×¤×¨×©×”
                const hRes = await fetch("https://www.hebcal.com/shabbat?cfg=json&geonameid=293397&m=50");
                const hData = await hRes.json();
                const hebDate = hData.items.find(i => i.category === 'hebdate').memo;
                const parasha = hData.items.find(i => i.category === 'parashat').hebrew;
                document.getElementById('heb-date').innerText = hebDate;
                document.getElementById('parasha').innerText = "×¤×¨×©×ª " + parasha;

                // ×–×× ×™ ×”×™×•×
                const zRes = await fetch("https://www.hebcal.com/zmanim?cfg=json&geonameid=293397");
                const zData = await zRes.json();
                const sel = { 
                    sunrise: '× ×¥ ×”×—××”', 
                    sof_zman_shma: '×¡×•×£ ×–××Ÿ ×§"×©', 
                    sof_zman_tfila: '×¡×•×£ ×–××Ÿ ×ª×¤×™×œ×”',
                    chatzot: '×—×¦×•×ª ×”×™×•×',
                    mincha_gedola: '×× ×—×” ×’×“×•×œ×”',
                    sunset: '×©×§×™×¢×”', 
                    tzeit: '×¦××ª ×”×›×•×›×‘×™×' 
                };
                let zHtml = '';
                for(let [k,v] of Object.entries(sel)) {
                    const t = new Date(zData.times[k]).toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit'});
                    zHtml += `
                        <div class="flex justify-between items-center bg-white p-6 rounded-2xl shadow-md border-r-[15px] border-slate-700">
                            <span class="text-5xl font-bold text-slate-700">${v}</span>
                            <span class="text-6xl font-black text-slate-900 tabular-nums">${t}</span>
                        </div>`;
                }
                document.getElementById('zmanim-list').innerHTML = zHtml;

                // ×©×™×¢×•×¨×™× ××—×‘"×“ (×“×¨×š ×¤×¨×•×§×¡×™)
                const sRes = await fetch("https://api.allorigins.win/get?url=" + encodeURIComponent("https://he.chabad.org/tools/rss/zmanim.xml?locationId=531&locationType=1&bDef=0&before=22"));
                const sData = await sRes.json();
                const parser = new DOMParser();
                const xml = parser.parseFromString(sData.contents, "text/xml");
                const studyItems = xml.querySelectorAll("item");
                let sHtml = '';
                // ×œ×•×§×—×™× ×¨×§ ×›×•×ª×¨×•×ª ×¨×œ×•×•× ×˜×™×•×ª ×©×œ ×—×ª"×ª/×¨××‘"× ×× ×§×™×™××•×ª ×‘-RSS
                studyItems.forEach((item, index) => {
                    if(index < 4) {
                        sHtml += `
                        <div class="bg-white p-8 rounded-3xl shadow-lg border-r-[15px] border-amber-600">
                            <div class="text-5xl font-black">${item.querySelector("title").textContent}</div>
                        </div>`;
                    }
                });
                document.getElementById('study-list').innerHTML = sHtml;

            } catch(e) { console.error("API Error", e); }
        }

        // -----------------------------------------
        // 4. × ×™×”×•×œ ×©×§×•×¤×™×•×ª
        // -----------------------------------------
        let currentSlide = 0;
        function rotateSlides() {
            const slides = document.querySelectorAll('.slide');
            slides[currentSlide].classList.remove('active');
            currentSlide = (currentSlide + 1) % slides.length;
            slides[currentSlide].classList.add('active');
        }

        // ×”×¤×¢×œ×”
        fetchExternalData();
        setInterval(rotateSlides, 15000); // 15 ×©× ×™×•×ª ×œ×©×§×•×¤×™×ª
        setInterval(fetchExternalData, 3600000); // ×¢×“×›×•×Ÿ APIs ×›×œ ×©×¢×”

    </script>
</body>
</html>
