<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ניהול חזון אליהו</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 min-h-screen p-4">
    <div id="login-form" class="max-w-md mx-auto bg-white p-8 rounded-2xl shadow-xl mt-10">
        <h2 class="text-2xl font-bold mb-6 text-center">כניסת מנהל</h2>
        <input type="email" id="email" placeholder="אימייל" class="w-full p-4 mb-4 border rounded-xl">
        <input type="password" id="pass" placeholder="סיסמה" class="w-full p-4 mb-6 border rounded-xl">
        <button id="login-btn" class="w-full bg-slate-800 text-white p-4 rounded-xl font-bold">התחברות</button>
    </div>

    <div id="admin-content" class="hidden max-w-4xl mx-auto">
        <nav class="flex bg-white shadow rounded-xl mb-6 overflow-hidden">
            <button onclick="tab(0)" class="flex-1 p-4 font-bold border-b-4 border-amber-500 bg-amber-50">⚙️</button>
            <button onclick="tab(1)" class="flex-1 p-4 font-bold">🕍</button>
            <button onclick="tab(2)" class="flex-1 p-4 font-bold">📢</button>
            <button onclick="tab(3)" class="flex-1 p-4 font-bold">🕯️</button>
        </nav>

        <div class="bg-white p-6 rounded-2xl shadow-lg">
            <div id="p0" class="panel block">
                <h3 class="font-bold mb-4">הגדרות כלליות</h3>
                <input type="text" id="set-name" placeholder="שם הישיבה" class="w-full p-3 border mb-3 rounded-lg">
                <textarea id="set-ticker" placeholder="טקסט רץ בתחתית" class="w-full p-3 border mb-3 rounded-lg h-24"></textarea>
                <button onclick="saveSettings()" class="w-full bg-amber-600 text-white p-4 rounded-xl font-bold">שמור הגדרות</button>
            </div>
            <div id="p1" class="panel hidden">
                <h3 class="font-bold mb-4">הוספת תפילה</h3>
                <input type="text" id="pr-name" placeholder="שם התפילה" class="w-full p-3 border mb-2 rounded-lg">
                <input type="text" id="pr-time" placeholder="שעה" class="w-full p-3 border mb-2 rounded-lg">
                <button onclick="add('prayers', {name:document.getElementById('pr-name').value, time:document.getElementById('pr-time').value})" class="w-full bg-green-600 text-white p-3 rounded-lg font-bold">הוסף +</button>
                <div id="list-prayers" class="mt-4 space-y-2"></div>
            </div>
            <div id="p2" class="panel hidden">
                <h3 class="font-bold mb-4">הודעות</h3>
                <input type="text" id="msg-text" placeholder="תוכן ההודעה" class="w-full p-3 border mb-2 rounded-lg">
                <button onclick="add('messages', {text:document.getElementById('msg-text').value})" class="w-full bg-green-600 text-white p-3 rounded-lg font-bold">הוסף מודעה</button>
                <div id="list-messages" class="mt-4 space-y-2"></div>
            </div>
            <div id="p3" class="panel hidden">
                <h3 class="font-bold mb-4">הקדשות</h3>
                <input type="text" id="ded-text" placeholder="תוכן ההקדשה" class="w-full p-3 border mb-2 rounded-lg">
                <button onclick="add('dedications', {text:document.getElementById('ded-text').value})" class="w-full bg-green-600 text-white p-3 rounded-lg font-bold">הוסף הקדשה</button>
                <div id="list-dedications" class="mt-4 space-y-2"></div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDe31VHniTkz_grYpA2e_RXx4g5Cnxa1ng",
            authDomain: "synagogue-board-tlv.firebaseapp.com",
            projectId: "synagogue-board-tlv",
            storageBucket: "synagogue-board-tlv.firebasestorage.app",
            messagingSenderId: "794671855844",
            appId: "1:794671855844:web:3e44c92b15f833784c14f1"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        document.getElementById('login-btn').onclick = () => {
            auth.signInWithEmailAndPassword(document.getElementById('email').value, document.getElementById('pass').value)
                .then(() => { document.getElementById('login-form').classList.add('hidden'); document.getElementById('admin-content').classList.remove('hidden'); })
                .catch(() => alert("שגיאה בפרטים"));
        };

        window.tab = (i) => {
            document.querySelectorAll('.panel').forEach((p, idx) => p.classList.toggle('hidden', idx !== i));
        };

        window.saveSettings = () => {
            db.collection("settings").doc("global").set({
                shul_name: document.getElementById('set-name').value,
                ticker: document.getElementById('set-ticker').value
            }).then(() => alert("נשמר!"));
        };

        window.add = (col, data) => {
            db.collection(col).add(data).then(() => alert("נוסף!"));
        };

        const sync = (col) => {
            db.collection(col).onSnapshot(snap => {
                let html = '';
                snap.forEach(doc => {
                    const d = doc.data();
                    html += `<div class="flex justify-between p-2 bg-slate-50 border rounded">
                        <span>${d.name || ''} ${d.time || ''} ${d.text || ''}</span>
                        <button onclick="firebase.firestore().collection('${col}').doc('${doc.id}').delete()" class="text-red-600 font-bold">מחק</button>
                    </div>`;
                });
                document.getElementById('list-' + col).innerHTML = html;
            });
        };
        ['prayers', 'messages', 'dedications'].forEach(sync);
    </script>
</body>
</html>
